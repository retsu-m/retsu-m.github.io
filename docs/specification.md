# レシートキャンペーンCMS 仕様書

## 1. プロジェクト概要

### 1.1 システム名
レシートキャンペーンCMS

### 1.2 システム概要
ノンエンジニアでも簡単にレシートキャンペーンサイトを作成できるCMSシステムです。管理者とクライアントがそれぞれ異なる権限でキャンペーンを管理でき、個人情報収集機能を備えたレシートキャンペーンの作成・管理・応募を一元化したプラットフォームです。

### 1.3 主要機能
- **管理者機能**: プロジェクト管理、ユーザー管理、システム全体の管理
- **クライアント機能**: キャンペーン設定、応募データ管理、プロジェクトセットアップ
- **キャンペーンページ**: 応募者向けの公開ページ（TOP、フォーム、確認、完了）

### 1.4 技術スタック
- **フロントエンド**: HTML5, CSS3 (Tailwind CSS), JavaScript (Vanilla JS)
- **レスポンシブ**: モバイルファーストデザイン
- **データ管理**: ローカルストレージ（現在）、将来的にサーバーサイド実装予定

---

## 2. システム構成

### 2.1 ディレクトリ構造
```
retsu-m/
├── index.html              # メインエントリーポイント
├── README.md               # プロジェクト概要
├── admin/                  # 管理者機能
│   ├── login.html          # 管理者ログイン
│   ├── dashboard.html      # 管理者ダッシュボード
│   ├── projects.html       # プロジェクト管理
│   ├── project-detail.html # プロジェクト詳細
│   └── users.html          # ユーザー管理
├── client/                 # クライアント機能
│   ├── login.html          # クライアントログイン
│   ├── dashboard.html      # クライアントダッシュボード
│   ├── setup.html          # プロジェクトセットアップ
│   ├── submissions.html    # 応募者管理
│   └── users.html          # ユーザー作成
├── campaign/               # キャンペーンページ（公開）
│   ├── top.html            # キャンペーントップページ
│   ├── form.html           # 応募フォーム
│   ├── confirm.html        # 確認画面
│   └── complete.html       # 完了画面
├── assets/                 # 静的ファイル
│   ├── css/                # スタイルシート
│   ├── js/                 # JavaScript
│   │   ├── components.js   # 共通コンポーネント
│   │   └── pagination.js   # ページネーション
│   └── images/             # 画像ファイル
└── docs/                   # ドキュメント
    ├── sitemap.md          # サイトマップ
    ├── progress.md         # 開発進捗
    └── specification.md    # 本仕様書
```

### 2.2 ユーザー権限
- **管理者**: システム全体の管理権限
- **クライアント**: 特定プロジェクトの管理権限
- **応募者**: キャンペーンページへのアクセス権限

---

## 3. 機能仕様

### 3.1 認証システム

#### 3.1.1 管理者認証
- **ログイン方式**: ユーザーID + パスワード
- **認証方法**: ローカルストレージベース
- **デフォルト認証情報**:
  - ユーザーID: `admin`
  - パスワード: `admin123`
- **セッション管理**: ブラウザローカルストレージ
- **ログアウト**: セッション情報の削除

#### 3.1.2 クライアント認証
- **ログイン方式**: プロジェクトID + パスワード
- **認証方法**: ローカルストレージベース
- **デフォルト認証情報**:
  - プロジェクトID: `project001`
  - パスワード: `client123`
- **セッション管理**: ブラウザローカルストレージ
- **ログアウト**: セッション情報の削除

### 3.2 管理者機能

#### 3.2.1 管理者ダッシュボード
**ファイル**: `admin/dashboard.html`

**機能**:
- 統計情報表示
  - 総プロジェクト数
  - アクティブプロジェクト数
  - 総ユーザー数
  - 今月の応募数
- 最近のプロジェクト一覧
- システム通知表示
- ナビゲーション機能

**データ項目**:
- プロジェクト統計
- ユーザー統計
- 応募統計
- アクティビティログ

#### 3.2.2 プロジェクト管理
**ファイル**: `admin/projects.html`

**機能**:
- プロジェクト一覧表示（グリッド表示）
- プロジェクト検索・フィルター機能
- プロジェクト作成・編集・削除
- プロジェクト詳細表示
- ステータス管理（作成中、公開中、終了）
- ページネーション

**データ項目**:
- プロジェクトID
- プロジェクト名
- クライアント名
- 作成日
- ステータス
- 応募数
- 説明

#### 3.2.3 プロジェクト詳細
**ファイル**: `admin/project-detail.html`

**機能**:
- プロジェクト基本情報表示
- 応募データ統計
- 応募者一覧表示
- レシート画像一覧
- プロジェクト設定編集

#### 3.2.4 ユーザー管理
**ファイル**: `admin/users.html`

**機能**:
- ユーザー一覧表示
- ユーザー検索・フィルター
- ユーザー作成・編集・削除
- 権限管理（管理者/クライアント）
- ステータス管理（有効/無効）
- パスワードリセット機能

**データ項目**:
- ユーザーID
- ユーザー名
- メールアドレス
- 権限
- ステータス
- 作成日
- 最終ログイン日

### 3.3 クライアント機能

#### 3.3.1 クライアントダッシュボード
**ファイル**: `client/dashboard.html`

**機能**:
- プロジェクト概要表示
- 応募統計情報
- 最近の応募者表示
- プロジェクトセットアップへのナビゲーション
- 応募者管理・ユーザー管理へのナビゲーション
- プロジェクト公開状態管理

**データ項目**:
- プロジェクト名
- クライアント名
- 作成日
- 公開状態
- 総応募数
- 今日の応募数

#### 3.3.2 プロジェクトセットアップ
**ファイル**: `client/setup.html`

**機能**:
- **キャンペーン設定タブ**:
  - キャンペーン設計（タイトル、開始日、終了日）
  - キャンペーンサイトテキスト（対象商品、対象店舗、応募方法、賞品、期間、資格、注意事項など）
- **フォーム設定タブ**:
  - 個人情報フォーム設定（名前、メール、住所、電話番号など）
  - アンケート項目設定（動的追加・削除）
  - レシートアップロード設定（最大枚数、説明文）
- **メインビジュアル設定タブ**:
  - 画像アップロード機能
  - プレビュー機能
- **メール設定タブ**:
  - メールテンプレート設定
- プレビュー・テスト・公開機能

**データ項目**:
- キャンペーンタイトル
- キャンペーン期間
- 対象商品・店舗
- 応募方法
- 賞品・当選者数
- 応募資格・注意事項
- アンケート項目
- レシートアップロード設定
- メインビジュアル画像

#### 3.3.3 応募者管理
**ファイル**: `client/submissions.html`

**機能**:
- 応募者一覧表示
- 個人情報表示（名前、メール、住所、電話番号）
- アンケート回答表示
- レシート画像表示
- 応募データ検索・フィルター
- CSVエクスポート機能
- 当選者選定機能

**データ項目**:
- 応募番号
- 応募日時
- 個人情報
- アンケート回答
- レシート画像
- 当選状況

#### 3.3.4 ユーザー作成
**ファイル**: `client/users.html`

**機能**:
- プロジェクトメンバー一覧
- 新規ユーザー作成
- 権限設定
- ユーザー編集・削除

### 3.4 キャンペーンページ（公開ページ）

#### 3.4.1 キャンペーントップページ
**ファイル**: `campaign/top.html`

**機能**:
- メインビジュアル表示
- キャンペーン内容表示（対象商品、期間、賞品など）
- 応募ボタン
- レスポンシブデザイン
- 注意事項・個人情報取り扱い表示

**表示項目**:
- キャンペーンタイトル
- メインビジュアル
- 対象商品・店舗
- 応募方法
- 賞品・当選者数
- キャンペーン期間
- 応募資格・注意事項

#### 3.4.2 応募フォーム
**ファイル**: `campaign/form.html`

**機能**:
- **個人情報セクション**:
  - 名前（必須）
  - メールアドレス（必須）
  - メールアドレス確認用（必須）
  - 郵便番号（必須、形式チェック）
  - 住所（必須）
  - 電話番号（必須、形式チェック）
- **アンケートセクション**:
  - 動的アンケートフォーム生成
  - テキスト、長文、ラジオ、チェックボックス対応
- **レシートアップロードセクション**:
  - レシートアップロード（最大20枚）
  - ドラッグ&ドロップ対応
  - プレビュー機能
- リアルタイムバリデーション
- プログレスバー表示

**バリデーション**:
- 必須項目チェック
- メールアドレス形式チェック
- 郵便番号形式チェック
- 電話番号形式チェック
- ファイルサイズ・形式チェック

#### 3.4.3 確認画面
**ファイル**: `campaign/confirm.html`

**機能**:
- **個人情報確認**:
  - 名前、メール、住所、電話番号の確認表示
- アンケート回答確認
- レシートアップロード確認
- 修正機能（前の画面に戻る）
- 応募確定処理

#### 3.4.4 完了画面
**ファイル**: `campaign/complete.html`

**機能**:
- 完了メッセージ表示
- 応募番号生成
- 今後の流れ説明
- トップページへの戻るボタン

---

## 4. データ仕様

### 4.1 プロジェクトデータ
```javascript
{
  id: "string",                    // プロジェクトID
  name: "string",                  // プロジェクト名
  clientName: "string",            // クライアント名
  description: "string",           // 説明
  createdAt: "ISO8601",           // 作成日
  status: "draft|active|ended",    // ステータス
  password: "string",              // パスワード
  isSetupComplete: boolean,        // セットアップ完了フラグ
  
  // キャンペーン設定
  campaign: {
    title: "string",               // キャンペーンタイトル
    startDate: "ISO8601",         // 開始日
    endDate: "ISO8601",           // 終了日
    targetProducts: "string",     // 対象商品
    targetStores: "string",       // 対象店舗
    applicationMethod: "string",  // 応募方法
    prizes: "string",             // 賞品
    period: "string",             // 期間
    qualifications: "string",     // 応募資格
    notes: "string"               // 注意事項
  },
  
  // フォーム設定
  form: {
    personalInfo: {               // 個人情報設定
      name: boolean,              // 名前（必須）
      email: boolean,             // メール（必須）
      emailConfirm: boolean,      // メール確認（必須）
      postalCode: boolean,        // 郵便番号（必須）
      address: boolean,           // 住所（必須）
      phone: boolean              // 電話番号（必須）
    },
    questionnaire: [              // アンケート項目
      {
        id: "string",
        type: "text|textarea|radio|checkbox",
        question: "string",
        required: boolean,
        options: ["string"]       // ラジオ・チェックボックス用
      }
    ],
    receiptUpload: {
      maxFiles: number,           // 最大ファイル数
      description: "string"       // 説明文
    }
  },
  
  // メインビジュアル
  mainVisual: {
    imageUrl: "string",           // 画像URL
    altText: "string"             // 代替テキスト
  }
}
```

### 4.2 応募データ
```javascript
{
  id: "string",                   // 応募ID
  projectId: "string",            // プロジェクトID
  submittedAt: "ISO8601",        // 応募日時
  applicationNumber: "string",    // 応募番号
  
  // 個人情報
  personalInfo: {
    lastName: "string",           // 姓
    firstName: "string",          // 名
    email: "string",              // メールアドレス
    postalCode: "string",         // 郵便番号
    address: "string",            // 住所
    phone: "string"               // 電話番号
  },
  
  // アンケート回答
  questionnaire: [
    {
      questionId: "string",
      answer: "string|array"      // 回答内容
    }
  ],
  
  // レシート画像
  receipts: [
    {
      id: "string",
      fileName: "string",
      fileSize: number,
      uploadDate: "ISO8601"
    }
  ],
  
  // 当選状況
  isWinner: boolean,              // 当選フラグ
  prize: "string"                 // 賞品
}
```

### 4.3 ユーザーデータ
```javascript
{
  id: "string",                   // ユーザーID
  username: "string",             // ユーザー名
  email: "string",                // メールアドレス
  role: "admin|client",           // 権限
  status: "active|inactive",      // ステータス
  projectId: "string",            // プロジェクトID（クライアント用）
  createdAt: "ISO8601",          // 作成日
  lastLoginAt: "ISO8601"         // 最終ログイン日
}
```

---

## 5. UI/UX仕様

### 5.1 デザインシステム
- **フレームワーク**: Tailwind CSS
- **カラーパレット**:
  - Primary: `#3B82F6` (青)
  - Secondary: `#10B981` (緑)
  - Accent: `#F59E0B` (オレンジ)
  - Summer: `#FF6B35` (夏色)
- **フォント**: システムフォント
- **アイコン**: Heroicons (SVG)

### 5.2 レスポンシブデザイン
- **ブレークポイント**:
  - Mobile: `< 768px`
  - Tablet: `768px - 1024px`
  - Desktop: `> 1024px`
- **モバイルファースト**: モバイルを基準としたデザイン

### 5.3 コンポーネント
- **ナビゲーション**: サイドメニュー + ヘッダー
- **カード**: 情報表示用のカードコンポーネント
- **ボタン**: プライマリ、セカンダリ、アウトライン
- **フォーム**: 入力フィールド、セレクトボックス、チェックボックス
- **モーダル**: 確認・編集用のモーダルウィンドウ
- **プログレスバー**: 進捗表示用

### 5.4 インタラクション
- **ホバーエフェクト**: ボタン、リンクのホバー状態
- **フォーカス状態**: フォーム要素のフォーカス表示
- **ローディング状態**: データ読み込み中の表示
- **エラー表示**: バリデーションエラーの表示

---

## 6. セキュリティ仕様

### 6.1 認証・認可
- **認証方式**: ローカルストレージベース（現在）
- **権限管理**: 管理者/クライアント/応募者の3段階
- **セッション管理**: ブラウザローカルストレージ
- **ログアウト**: セッション情報の完全削除

### 6.2 データ保護
- **個人情報**: 暗号化保存（将来的に実装）
- **ファイルアップロード**: サイズ・形式制限
- **入力値検証**: フロントエンド・バックエンド両方で実装予定

### 6.3 脆弱性対策
- **XSS対策**: 入力値のエスケープ処理
- **CSRF対策**: 将来的にトークン実装予定
- **SQLインジェクション**: 将来的にプリペアドステートメント実装予定

---

## 7. パフォーマンス仕様

### 7.1 ページ読み込み
- **初期読み込み**: 3秒以内
- **画像最適化**: WebP形式対応予定
- **キャッシュ**: ブラウザキャッシュ活用

### 7.2 データ処理
- **ページネーション**: 大量データの分割表示
- **検索機能**: リアルタイム検索
- **フィルター**: 高速フィルタリング

### 7.3 ファイルアップロード
- **最大ファイルサイズ**: 10MB
- **対応形式**: JPG, PNG, PDF
- **同時アップロード**: 最大20ファイル

---

## 8. 運用・保守仕様

### 8.1 ログ管理
- **アクセスログ**: ページアクセス記録
- **エラーログ**: エラー発生時の記録
- **操作ログ**: 重要な操作の記録

### 8.2 バックアップ
- **データバックアップ**: 定期的なデータ保存
- **ファイルバックアップ**: アップロードファイルの保存
- **設定バックアップ**: システム設定の保存

### 8.3 監視
- **システム監視**: 稼働状況の監視
- **パフォーマンス監視**: レスポンス時間の監視
- **セキュリティ監視**: 不正アクセスの監視

---

## 9. 将来拡張予定

### 9.1 バックエンド実装
- **サーバーサイド**: Node.js + Express
- **データベース**: MongoDB
- **ファイルストレージ**: AWS S3
- **認証**: JWT + セッション管理

### 9.2 追加機能
- **画像編集機能**: レシート画像の編集・加工
- **テンプレート機能**: キャンペーンテンプレート
- **多言語対応**: 英語・中国語対応
- **アクセス解析**: Google Analytics連携
- **メール配信**: 応募完了メール・当選通知メール

### 9.3 モバイル対応
- **PWA対応**: プログレッシブウェブアプリ
- **ネイティブアプリ**: React Native版
- **オフライン対応**: オフライン時の機能

---

## 10. テスト仕様

### 10.1 単体テスト
- **JavaScript関数**: Jest によるテスト
- **コンポーネント**: コンポーネント単位のテスト
- **ユーティリティ**: 共通関数のテスト

### 10.2 統合テスト
- **認証フロー**: ログイン・ログアウトのテスト
- **データ操作**: CRUD操作のテスト
- **ファイルアップロード**: アップロード機能のテスト

### 10.3 E2Eテスト
- **ユーザーフロー**: エンドツーエンドのテスト
- **応募フロー**: 応募から完了までのテスト
- **管理フロー**: 管理機能のテスト

---

## 11. デプロイメント仕様

### 11.1 開発環境
- **ローカル開発**: ブラウザでの直接実行
- **開発サーバー**: Live Server（VS Code拡張）

### 11.2 本番環境（将来的）
- **Webサーバー**: Nginx
- **アプリケーションサーバー**: Node.js
- **データベース**: MongoDB
- **ファイルストレージ**: AWS S3
- **CDN**: CloudFront

### 11.3 CI/CD（将来的）
- **ビルド**: GitHub Actions
- **テスト**: 自動テスト実行
- **デプロイ**: 自動デプロイメント

---

## 12. ドキュメント

### 12.1 技術ドキュメント
- **API仕様書**: 将来的に実装予定
- **データベース設計書**: 将来的に実装予定
- **コンポーネント仕様書**: 本仕様書に含む

### 12.2 運用ドキュメント
- **運用マニュアル**: 管理者向け
- **ユーザーマニュアル**: クライアント向け
- **トラブルシューティング**: 問題解決ガイド

---

## 13. 制約事項

### 13.1 技術的制約
- **ブラウザ対応**: モダンブラウザのみ
- **ファイルサイズ**: アップロードファイル10MB制限
- **同時接続**: ローカルストレージの制限

### 13.2 運用制約
- **データ永続化**: ローカルストレージのみ（現在）
- **セキュリティ**: フロントエンドのみの認証
- **スケーラビリティ**: 大量データ対応未実装

---

## 14. 変更履歴

### v1.0.0 (2024年1月)
- 初期バージョンリリース
- 基本機能実装
- フロントエンドのみの実装

### 今後の予定
- v1.1.0: クライアント機能拡張
- v1.2.0: バックエンド実装
- v2.0.0: 本格運用版

---

## 15. 連絡先・サポート

### 15.1 開発チーム
- **プロジェクトマネージャー**: 未定
- **フロントエンド開発**: 未定
- **バックエンド開発**: 未定
- **UI/UXデザイン**: 未定

### 15.2 サポート
- **技術サポート**: 開発チーム
- **運用サポート**: 管理者
- **ユーザーサポート**: クライアント担当者

---

*この仕様書は2024年1月時点の内容です。今後の開発により変更される可能性があります。* 