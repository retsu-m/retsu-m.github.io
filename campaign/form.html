<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>応募フォーム - 夏のレシートキャンペーン</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#F59E0B'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <!-- ヘッダー -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="top.html" class="text-xl font-semibold text-gray-900">夏のレシートキャンペーン</a>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">ステップ 1/3</span>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <!-- プログレスバー -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center">
                        <span class="text-white text-sm font-medium">1</span>
                    </div>
                    <span class="ml-2 text-sm font-medium text-gray-900">応募フォーム</span>
                </div>
                <div class="flex-1 mx-4">
                    <div class="h-1 bg-gray-200 rounded-full">
                        <div class="h-1 bg-primary rounded-full" style="width: 33%"></div>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">
                        <span class="text-gray-500 text-sm font-medium">2</span>
                    </div>
                    <span class="ml-2 text-sm text-gray-500">確認</span>
                </div>
                <div class="flex-1 mx-4">
                    <div class="h-1 bg-gray-200 rounded-full"></div>
                </div>
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">
                        <span class="text-gray-500 text-sm font-medium">3</span>
                    </div>
                    <span class="ml-2 text-sm text-gray-500">完了</span>
                </div>
            </div>
        </div>

        <!-- フォーム -->
        <div class="bg-white shadow-sm border border-gray-200 rounded-lg">
            <div class="px-8 py-10">
                <h2 class="text-2xl font-bold text-gray-900 mb-8 text-center">応募フォーム</h2>
                
                <form id="application-form" class="space-y-8">
                    <!-- 個人情報セクション -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-6 pb-2 border-b border-gray-200">個人情報</h3>
                        <div class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        姓 <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" name="last_name" required
                                           placeholder="例: 田中"
                                           class="block w-full md:w-3/4 px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-base"
                                           oninput="formatName(this)">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        名 <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" name="first_name" required
                                           placeholder="例: 太郎"
                                           class="block w-full md:w-3/4 px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-base"
                                           oninput="formatName(this)">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    メールアドレス <span class="text-red-500">*</span>
                                </label>
                                <input type="email" name="email" required
                                       placeholder="例: tanaka@example.com"
                                       class="block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-base"
                                       oninput="formatEmail(this)">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    メールアドレス確認用 <span class="text-red-500">*</span>
                                </label>
                                <input type="email" name="email_confirm" required
                                       placeholder="例: tanaka@example.com"
                                       class="block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-base"
                                       oninput="formatEmail(this)">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    電話番号 <span class="text-red-500">*</span>
                                </label>
                                <div class="flex space-x-2 w-full md:w-1/2">
                                    <input type="tel" name="phone_1" required
                                           placeholder="090"
                                           maxlength="4"
                                           class="block w-1/3 px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-base"
                                           oninput="formatPhoneNumber(this, 1)">
                                    <span class="flex items-center text-gray-500 text-lg">-</span>
                                    <input type="tel" name="phone_2" required
                                           placeholder="1234"
                                           maxlength="4"
                                           class="block w-1/3 px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-base"
                                           oninput="formatPhoneNumber(this, 2)">
                                    <span class="flex items-center text-gray-500 text-lg">-</span>
                                    <input type="tel" name="phone_3" required
                                           placeholder="5678"
                                           maxlength="4"
                                           class="block w-1/3 px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-base"
                                           oninput="formatPhoneNumber(this, 3)">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    郵便番号 <span class="text-red-500">*</span>
                                </label>
                                <div class="flex space-x-2 w-full md:w-1/2">
                                    <input type="text" name="postal_code_1" required
                                           placeholder="123"
                                           maxlength="3"
                                           class="block w-1/2 px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-base"
                                           oninput="formatPostalCode(this, 1)">
                                    <span class="flex items-center text-gray-500 text-lg">-</span>
                                    <input type="text" name="postal_code_2" required
                                           placeholder="4567"
                                           maxlength="4"
                                           class="block w-1/2 px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-base"
                                           oninput="formatPostalCode(this, 2)">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    都道府県 <span class="text-red-500">*</span>
                                </label>
                                <select name="prefecture" required
                                        class="block w-full md:w-1/2 px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-base"
                                        onchange="markAsChanged()">
                                    <option value="">選択してください</option>
                                    <option value="北海道">北海道</option>
                                    <option value="青森県">青森県</option>
                                    <option value="岩手県">岩手県</option>
                                    <option value="宮城県">宮城県</option>
                                    <option value="秋田県">秋田県</option>
                                    <option value="山形県">山形県</option>
                                    <option value="福島県">福島県</option>
                                    <option value="茨城県">茨城県</option>
                                    <option value="栃木県">栃木県</option>
                                    <option value="群馬県">群馬県</option>
                                    <option value="埼玉県">埼玉県</option>
                                    <option value="千葉県">千葉県</option>
                                    <option value="東京都">東京都</option>
                                    <option value="神奈川県">神奈川県</option>
                                    <option value="新潟県">新潟県</option>
                                    <option value="富山県">富山県</option>
                                    <option value="石川県">石川県</option>
                                    <option value="福井県">福井県</option>
                                    <option value="山梨県">山梨県</option>
                                    <option value="長野県">長野県</option>
                                    <option value="岐阜県">岐阜県</option>
                                    <option value="静岡県">静岡県</option>
                                    <option value="愛知県">愛知県</option>
                                    <option value="三重県">三重県</option>
                                    <option value="滋賀県">滋賀県</option>
                                    <option value="京都府">京都府</option>
                                    <option value="大阪府">大阪府</option>
                                    <option value="兵庫県">兵庫県</option>
                                    <option value="奈良県">奈良県</option>
                                    <option value="和歌山県">和歌山県</option>
                                    <option value="鳥取県">鳥取県</option>
                                    <option value="島根県">島根県</option>
                                    <option value="岡山県">岡山県</option>
                                    <option value="広島県">広島県</option>
                                    <option value="山口県">山口県</option>
                                    <option value="徳島県">徳島県</option>
                                    <option value="香川県">香川県</option>
                                    <option value="愛媛県">愛媛県</option>
                                    <option value="高知県">高知県</option>
                                    <option value="福岡県">福岡県</option>
                                    <option value="佐賀県">佐賀県</option>
                                    <option value="長崎県">長崎県</option>
                                    <option value="熊本県">熊本県</option>
                                    <option value="大分県">大分県</option>
                                    <option value="宮崎県">宮崎県</option>
                                    <option value="鹿児島県">鹿児島県</option>
                                    <option value="沖縄県">沖縄県</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    市区町村 <span class="text-red-500">*</span>
                                </label>
                                <input type="text" name="city" required
                                       placeholder="例: 渋谷区"
                                       class="block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-base"
                                       oninput="markAsChanged()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    番地 <span class="text-red-500">*</span>
                                </label>
                                <input type="text" name="address" required
                                       placeholder="例: 渋谷1-1-1"
                                       class="block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-base"
                                       oninput="markAsChanged()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    マンション・ビル名
                                </label>
                                <input type="text" name="building"
                                       placeholder="例: 渋谷ビル 101号室"
                                       class="block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-base"
                                       oninput="markAsChanged()">
                            </div>
                        </div>
                    </div>

                    <!-- アンケートセクション -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-6 pb-2 border-b border-gray-200">アンケート</h3>
                        <div id="question-fields" class="space-y-6">
                            <!-- 質問フィールドはJavaScriptで動的に生成 -->
                        </div>
                    </div>

                    <!-- レシートアップロードセクション -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-6 pb-2 border-b border-gray-200">レシートアップロード</h3>
                        <div class="space-y-4">
                            <p class="text-sm text-gray-600">
                                対象商品のレシートを撮影してアップロードしてください。最大20枚までアップロード可能です。
                            </p>
                            
                            <div id="receipt-upload-area" class="space-y-4">
                                <!-- レシートアップロードエリアはJavaScriptで動的に生成 -->
                            </div>
                            
                            <button type="button" onclick="addReceiptUpload()" 
                                    class="inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                レシートを追加
                            </button>
                        </div>
                    </div>

                    <!-- 規約同意セクション -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-6 pb-2 border-b border-gray-200">規約への同意</h3>
                        <div class="space-y-4">
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 max-h-60 overflow-y-auto">
                                <h4 class="text-sm font-medium text-gray-900 mb-3">利用規約</h4>
                                <div class="text-xs text-gray-600 space-y-3">
                                    <p>第1条（適用）</p>
                                    <p>本規約は、当社が提供するキャンペーンサービス（以下「本サービス」）の利用条件を定めるものです。</p>
                                    
                                    <p>第2条（利用登録）</p>
                                    <p>本サービスの利用を希望する者は、本規約に同意の上、当社の定める方法によって利用登録を申請するものとします。</p>
                                    
                                    <p>第3条（禁止事項）</p>
                                    <p>利用者は、本サービスの利用にあたり、以下の行為をしてはなりません。</p>
                                    <ul class="list-disc list-inside ml-4 space-y-1">
                                        <li>法令または公序良俗に違反する行為</li>
                                        <li>犯罪行為に関連する行為</li>
                                        <li>当社のサーバーまたはネットワークの機能を破壊したり、妨害したりする行為</li>
                                        <li>本サービスの運営を妨害するおそれのある行為</li>
                                        <li>他の利用者に関する個人情報等を収集または蓄積する行為</li>
                                        <li>他の利用者に成りすます行為</li>
                                        <li>当社のサービスに関連して、反社会的勢力に対して直接または間接に利益を供与する行為</li>
                                        <li>その他、当社が不適切と判断する行為</li>
                                    </ul>
                                    
                                    <p>第4条（本サービスの提供の停止等）</p>
                                    <p>当社は、以下のいずれかの事由があると判断した場合、利用者に事前に通知することなく本サービスの全部または一部の提供を停止または中断することができるものとします。</p>
                                    
                                    <p>第5条（利用制限および登録抹消）</p>
                                    <p>当社は、利用者が以下のいずれかに該当する場合には、事前の通知なく、利用者に対して、本サービスの全部もしくは一部の利用を制限し、または利用者としての登録を抹消することができるものとします。</p>
                                    
                                    <p>第6条（免責事項）</p>
                                    <p>当社は、本サービスに関して、利用者と他の利用者または第三者との間において生じた取引、連絡または紛争等について一切責任を負いません。</p>
                                    
                                    <p>第7条（サービス内容の変更等）</p>
                                    <p>当社は、利用者に通知することなく、本サービスの内容を変更しまたは本サービスの提供を中止することができるものとし、これによって利用者に生じた損害について一切の責任を負いません。</p>
                                    
                                    <p>第8条（利用規約の変更）</p>
                                    <p>当社は、必要と判断した場合には、利用者に通知することなくいつでも本規約を変更することができるものとします。</p>
                                    
                                    <p>第9条（通知または連絡）</p>
                                    <p>利用者と当社との間の通知または連絡は、当社の定める方法によって行うものとします。</p>
                                    
                                    <p>第10条（権利義務の譲渡の禁止）</p>
                                    <p>利用者は、当社の書面による事前の承諾なく、利用契約上の地位または本規約に基づく権利もしくは義務を第三者に譲渡し、または担保に供することはできません。</p>
                                    
                                    <p>第11条（準拠法・裁判管轄）</p>
                                    <p>本規約の解釈にあたっては、日本法を準拠法とします。</p>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <input type="checkbox" id="terms-agreement" name="termsAgreement" required
                                       class="h-5 w-5 text-primary focus:ring-primary border-gray-300 rounded mt-1"
                                       onchange="markAsChanged()">
                                <label for="terms-agreement" class="ml-3 block text-sm text-gray-900">
                                    上記の利用規約に同意します <span class="text-red-500">*</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- 送信ボタン -->
                    <div class="flex justify-between pt-8 border-t border-gray-200">
                        <a href="top.html" 
                           class="inline-flex items-center px-8 py-4 border border-gray-300 text-lg font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                            戻る
                        </a>
                        <button type="submit" 
                                class="inline-flex items-center px-8 py-4 border border-transparent text-lg font-medium rounded-md text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            確認画面へ
                            <svg class="w-6 h-6 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- フッター -->
    <footer class="bg-gray-800 mt-12">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <p class="mt-8 text-sm text-gray-400">
                    © キャンペーン作成年 [キャンペーン名] All rights reserved.
                </p>
            </div>
        </div>
    </footer>

    <script>
        // 自動フォーマット機能
        function formatPostalCode(input, part) {
            // 全角数字を半角に変換
            let value = input.value.replace(/[０-９]/g, function(s) {
                return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
            });
            
            // 数字以外を除去
            value = value.replace(/[^0-9]/g, '');
            
            input.value = value;
            
            // 次のフィールドにフォーカス移動
            if (part === 1 && value.length === 3) {
                document.querySelector('input[name="postal_code_2"]').focus();
            }
            
            // 郵便番号が完成したら住所自動入力
            if (part === 2 && value.length === 4) {
                const postalCode1 = document.querySelector('input[name="postal_code_1"]').value;
                const postalCode2 = value;
                if (postalCode1.length === 3 && postalCode2.length === 4) {
                    const fullPostalCode = postalCode1 + postalCode2;
                    autoFillAddress(fullPostalCode);
                }
            }
            
            // 郵便番号1の部分が3桁になった時点でもチェック
            if (part === 1 && value.length === 3) {
                const postalCode2 = document.querySelector('input[name="postal_code_2"]').value;
                if (postalCode2.length === 4) {
                    const fullPostalCode = value + postalCode2;
                    autoFillAddress(fullPostalCode);
                }
            }
            
            markAsChanged();
        }

        function formatPhoneNumber(input, part) {
            // 数字以外を削除
            let value = input.value.replace(/[^\d]/g, '');
            
            // 4桁に制限
            if (value.length > 4) {
                value = value.substring(0, 4);
            }
            
            input.value = value;
        }

        function formatName(input) {
            // 全角スペースを半角スペースに変換
            let value = input.value.replace(/　/g, ' ');
            
            // 連続するスペースを1つに
            value = value.replace(/\s+/g, ' ');
            
            // 前後のスペースを削除
            value = value.trim();
            
            input.value = value;
        }

        function formatEmail(input) {
            // 全角文字を半角文字に変換
            let value = input.value.replace(/[^\x00-\x7F]/g, '');
            
            input.value = value;
        }

        // 住所自動入力機能
        function autoFillAddress(postalCode) {
            // 郵便番号検索APIを使用
            fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${postalCode}`)
                .then(response => response.json())
                .then(data => {
                    if (data.results && data.results.length > 0) {
                        const result = data.results[0];
                        const prefecture = result.address1; // 都道府県
                        const city = result.address2; // 市区町村
                        const address = result.address3; // 町域
                        
                        // フォームに自動入力
                        document.querySelector('select[name="prefecture"]').value = prefecture;
                        document.querySelector('input[name="city"]').value = city;
                        document.querySelector('input[name="address"]').value = address;
                        
                        // 成功メッセージを表示
                        showSuccessMessage('住所を自動入力しました');
                    } else {
                        // APIで見つからない場合はサンプルデータを使用
                        const addressData = {
                            '1000001': { prefecture: '東京都', city: '千代田区', address: '千代田' },
                            '1000002': { prefecture: '東京都', city: '千代田区', address: '皇居外苑' },
                            '1000003': { prefecture: '東京都', city: '千代田区', address: '一ツ橋' },
                            '1000004': { prefecture: '東京都', city: '千代田区', address: '大手町' },
                            '1000005': { prefecture: '東京都', city: '千代田区', address: '丸の内' },
                            '1000006': { prefecture: '東京都', city: '千代田区', address: '有楽町' },
                            '1000007': { prefecture: '東京都', city: '千代田区', address: '霞が関' },
                            '1000008': { prefecture: '東京都', city: '千代田区', address: '永田町' },
                            '1000009': { prefecture: '東京都', city: '千代田区', address: '北の丸公園' },
                            '1000010': { prefecture: '東京都', city: '千代田区', address: '日比谷' },
                            '1000011': { prefecture: '東京都', city: '千代田区', address: '内幸町' },
                            '1000012': { prefecture: '東京都', city: '千代田区', address: '日比谷公園' },
                            '1000013': { prefecture: '東京都', city: '千代田区', address: '霞が関' },
                            '1000014': { prefecture: '東京都', city: '千代田区', address: '麹町' },
                            '1000015': { prefecture: '東京都', city: '千代田区', address: '平河町' },
                            '1000016': { prefecture: '東京都', city: '千代田区', address: '紀尾井町' },
                            '1000017': { prefecture: '東京都', city: '千代田区', address: '番町' },
                            '1000018': { prefecture: '東京都', city: '千代田区', address: '三番町' },
                            '1000019': { prefecture: '東京都', city: '千代田区', address: '四番町' },
                            '1000020': { prefecture: '東京都', city: '千代田区', address: '五番町' },
                            '1000021': { prefecture: '東京都', city: '千代田区', address: '六番町' },
                            '1000022': { prefecture: '東京都', city: '千代田区', address: '七番町' },
                            '1000023': { prefecture: '東京都', city: '千代田区', address: '八番町' },
                            '1000024': { prefecture: '東京都', city: '千代田区', address: '九番町' },
                            '1000025': { prefecture: '東京都', city: '千代田区', address: '一番町' },
                            '1000026': { prefecture: '東京都', city: '千代田区', address: '二番町' },
                            '1000027': { prefecture: '東京都', city: '千代田区', address: '三番町' },
                            '1000028': { prefecture: '東京都', city: '千代田区', address: '四番町' },
                            '1000029': { prefecture: '東京都', city: '千代田区', address: '五番町' },
                            '1000030': { prefecture: '東京都', city: '千代田区', address: '六番町' },
                            '1000031': { prefecture: '東京都', city: '千代田区', address: '七番町' },
                            '1000032': { prefecture: '東京都', city: '千代田区', address: '八番町' },
                            '1000033': { prefecture: '東京都', city: '千代田区', address: '九番町' },
                            '1000034': { prefecture: '東京都', city: '千代田区', address: '一番町' },
                            '1000035': { prefecture: '東京都', city: '千代田区', address: '二番町' },
                            '1000036': { prefecture: '東京都', city: '千代田区', address: '三番町' },
                            '1000037': { prefecture: '東京都', city: '千代田区', address: '四番町' },
                            '1000038': { prefecture: '東京都', city: '千代田区', address: '五番町' },
                            '1000039': { prefecture: '東京都', city: '千代田区', address: '六番町' },
                            '1000040': { prefecture: '東京都', city: '千代田区', address: '七番町' },
                            '1000041': { prefecture: '東京都', city: '千代田区', address: '八番町' },
                            '1000042': { prefecture: '東京都', city: '千代田区', address: '九番町' },
                            '1000043': { prefecture: '東京都', city: '千代田区', address: '一番町' },
                            '1000044': { prefecture: '東京都', city: '千代田区', address: '二番町' },
                            '1000045': { prefecture: '東京都', city: '千代田区', address: '三番町' },
                            '1000046': { prefecture: '東京都', city: '千代田区', address: '四番町' },
                            '1000047': { prefecture: '東京都', city: '千代田区', address: '五番町' },
                            '1000048': { prefecture: '東京都', city: '千代田区', address: '六番町' },
                            '1000049': { prefecture: '東京都', city: '千代田区', address: '七番町' },
                            '1000050': { prefecture: '東京都', city: '千代田区', address: '八番町' },
                            '1000051': { prefecture: '東京都', city: '千代田区', address: '九番町' },
                            '1000052': { prefecture: '東京都', city: '千代田区', address: '一番町' },
                            '1000053': { prefecture: '東京都', city: '千代田区', address: '二番町' },
                            '1000054': { prefecture: '東京都', city: '千代田区', address: '三番町' },
                            '1000055': { prefecture: '東京都', city: '千代田区', address: '四番町' },
                            '1000056': { prefecture: '東京都', city: '千代田区', address: '五番町' },
                            '1000057': { prefecture: '東京都', city: '千代田区', address: '六番町' },
                            '1000058': { prefecture: '東京都', city: '千代田区', address: '七番町' },
                            '1000059': { prefecture: '東京都', city: '千代田区', address: '八番町' },
                            '1000060': { prefecture: '東京都', city: '千代田区', address: '九番町' },
                            '1000061': { prefecture: '東京都', city: '千代田区', address: '一番町' },
                            '1000062': { prefecture: '東京都', city: '千代田区', address: '二番町' },
                            '1000063': { prefecture: '東京都', city: '千代田区', address: '三番町' },
                            '1000064': { prefecture: '東京都', city: '千代田区', address: '四番町' },
                            '1000065': { prefecture: '東京都', city: '千代田区', address: '五番町' },
                            '1000066': { prefecture: '東京都', city: '千代田区', address: '六番町' },
                            '1000067': { prefecture: '東京都', city: '千代田区', address: '七番町' },
                            '1000068': { prefecture: '東京都', city: '千代田区', address: '八番町' },
                            '1000069': { prefecture: '東京都', city: '千代田区', address: '九番町' },
                            '1000070': { prefecture: '東京都', city: '千代田区', address: '一番町' },
                            '1000071': { prefecture: '東京都', city: '千代田区', address: '二番町' },
                            '1000072': { prefecture: '東京都', city: '千代田区', address: '三番町' },
                            '1000073': { prefecture: '東京都', city: '千代田区', address: '四番町' },
                            '1000074': { prefecture: '東京都', city: '千代田区', address: '五番町' },
                            '1000075': { prefecture: '東京都', city: '千代田区', address: '六番町' },
                            '1000076': { prefecture: '東京都', city: '千代田区', address: '七番町' },
                            '1000077': { prefecture: '東京都', city: '千代田区', address: '八番町' },
                            '1000078': { prefecture: '東京都', city: '千代田区', address: '九番町' },
                            '1000079': { prefecture: '東京都', city: '千代田区', address: '一番町' },
                            '1000080': { prefecture: '東京都', city: '千代田区', address: '二番町' },
                            '1000081': { prefecture: '東京都', city: '千代田区', address: '三番町' },
                            '1000082': { prefecture: '東京都', city: '千代田区', address: '四番町' },
                            '1000083': { prefecture: '東京都', city: '千代田区', address: '五番町' },
                            '1000084': { prefecture: '東京都', city: '千代田区', address: '六番町' },
                            '1000085': { prefecture: '東京都', city: '千代田区', address: '七番町' },
                            '1000086': { prefecture: '東京都', city: '千代田区', address: '八番町' },
                            '1000087': { prefecture: '東京都', city: '千代田区', address: '九番町' },
                            '1000088': { prefecture: '東京都', city: '千代田区', address: '一番町' },
                            '1000089': { prefecture: '東京都', city: '千代田区', address: '二番町' },
                            '1000090': { prefecture: '東京都', city: '千代田区', address: '三番町' },
                            '1000091': { prefecture: '東京都', city: '千代田区', address: '四番町' },
                            '1000092': { prefecture: '東京都', city: '千代田区', address: '五番町' },
                            '1000093': { prefecture: '東京都', city: '千代田区', address: '六番町' },
                            '1000094': { prefecture: '東京都', city: '千代田区', address: '七番町' },
                            '1000095': { prefecture: '東京都', city: '千代田区', address: '八番町' },
                            '1000096': { prefecture: '東京都', city: '千代田区', address: '九番町' },
                            '1000097': { prefecture: '東京都', city: '千代田区', address: '一番町' },
                            '1000098': { prefecture: '東京都', city: '千代田区', address: '二番町' },
                            '1000099': { prefecture: '東京都', city: '千代田区', address: '三番町' },
                            '1000100': { prefecture: '東京都', city: '千代田区', address: '四番町' }
                        };
                        
                        const address = addressData[postalCode];
                        if (address) {
                            document.querySelector('select[name="prefecture"]').value = address.prefecture;
                            document.querySelector('input[name="city"]').value = address.city;
                            document.querySelector('input[name="address"]').value = address.address;
                            
                            // 成功メッセージを表示
                            showSuccessMessage('住所を自動入力しました');
                        } else {
                            showSuccessMessage('郵便番号が見つかりませんでした');
                        }
                    }
                })
                .catch(error => {
                    console.error('郵便番号検索エラー:', error);
                    // エラー時はサンプルデータを使用
                    const addressData = {
                        '1000001': { prefecture: '東京都', city: '千代田区', address: '千代田' },
                        '1000002': { prefecture: '東京都', city: '千代田区', address: '皇居外苑' },
                        '1000003': { prefecture: '東京都', city: '千代田区', address: '一ツ橋' },
                        '1000004': { prefecture: '東京都', city: '千代田区', address: '大手町' },
                        '1000005': { prefecture: '東京都', city: '千代田区', address: '丸の内' },
                        '1000006': { prefecture: '東京都', city: '千代田区', address: '有楽町' },
                        '1000007': { prefecture: '東京都', city: '千代田区', address: '霞が関' },
                        '1000008': { prefecture: '東京都', city: '千代田区', address: '永田町' },
                        '1000009': { prefecture: '東京都', city: '千代田区', address: '北の丸公園' },
                        '1000010': { prefecture: '東京都', city: '千代田区', address: '日比谷' }
                    };
                    
                    const address = addressData[postalCode];
                    if (address) {
                        document.querySelector('select[name="prefecture"]').value = address.prefecture;
                        document.querySelector('input[name="city"]').value = address.city;
                        document.querySelector('input[name="address"]').value = address.address;
                        
                        // 成功メッセージを表示
                        showSuccessMessage('住所を自動入力しました');
                    }
                });
        }

        // 成功メッセージ表示
        function showSuccessMessage(message) {
            // 既存のメッセージを削除
            const existingMessage = document.querySelector('.success-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'success-message fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-md shadow-lg z-50';
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            // 3秒後に自動で削除
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // 入力内容の保存
        function saveFormData() {
            const formData = new FormData(document.getElementById('application-form'));
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            localStorage.setItem('formData', JSON.stringify(data));
        }

        // 入力内容の復元
        function restoreFormData() {
            const savedData = localStorage.getItem('formData');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                Object.keys(data).forEach(key => {
                    const element = document.querySelector(`[name="${key}"]`);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = data[key] === 'on';
                        } else {
                            element.value = data[key];
                        }
                    }
                });
                
                showSuccessMessage('前回の入力内容を復元しました');
            }
        }

        // 変更をマーク
        function markAsChanged() {
            saveFormData();
        }

        // 離脱時のアラート
        let hasUnsavedChanges = false;
        
        window.addEventListener('beforeunload', function(e) {
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = '入力内容が保存されていません。このページを離れますか？';
                return e.returnValue;
            }
        });

        // フォーム入力時の変更検知
        document.addEventListener('input', function() {
            hasUnsavedChanges = true;
        });

        // フォーム送信処理
        document.getElementById('application-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 個人情報のバリデーション
            let isValid = true;
            const errorMessages = [];

            // 必須フィールドのチェック
            const requiredFields = document.querySelectorAll('[required]');
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.classList.add('border-red-500');
                } else {
                    field.classList.remove('border-red-500');
                }
            });

            // メールアドレス確認のチェック
            const email = document.querySelector('input[name="email"]').value;
            const emailConfirm = document.querySelector('input[name="email_confirm"]').value;
            if (email !== emailConfirm) {
                isValid = false;
                errorMessages.push('メールアドレスが一致しません');
                document.querySelector('input[name="email_confirm"]').classList.add('border-red-500');
            } else {
                document.querySelector('input[name="email_confirm"]').classList.remove('border-red-500');
            }

            // 郵便番号の形式チェック
            const postalField1 = document.querySelector('input[name="postal_code_1"]');
            const postalField2 = document.querySelector('input[name="postal_code_2"]');
            if (postalField1 && postalField2 && (postalField1.value || postalField2.value)) {
                const postalPattern = /^\d{3}-?\d{4}$/;
                const postalValue = postalField1.value + '-' + postalField2.value;
                if (!postalPattern.test(postalValue)) {
                    isValid = false;
                    errorMessages.push('郵便番号は3桁-4桁の形式で入力してください');
                    postalField1.classList.add('border-red-500');
                    postalField2.classList.add('border-red-500');
                } else {
                    postalField1.classList.remove('border-red-500');
                    postalField2.classList.remove('border-red-500');
                }
            }

            // 電話番号の形式チェック
            const phoneField1 = document.querySelector('input[name="phone_1"]');
            const phoneField2 = document.querySelector('input[name="phone_2"]');
            const phoneField3 = document.querySelector('input[name="phone_3"]');
            if (phoneField1 && phoneField2 && phoneField3 && (phoneField1.value || phoneField2.value || phoneField3.value)) {
                const phonePattern = /^\d{1,4}-\d{1,4}-\d{4}$/;
                const phoneValue = phoneField1.value + '-' + phoneField2.value + '-' + phoneField3.value;
                if (!phonePattern.test(phoneValue)) {
                    isValid = false;
                    errorMessages.push('電話番号は正しい形式で入力してください');
                    phoneField1.classList.add('border-red-500');
                    phoneField2.classList.add('border-red-500');
                    phoneField3.classList.add('border-red-500');
                } else {
                    phoneField1.classList.remove('border-red-500');
                    phoneField2.classList.remove('border-red-500');
                    phoneField3.classList.remove('border-red-500');
                }
            }

            // 規約同意のチェック
            const termsAgreement = document.getElementById('terms-agreement');
            if (!termsAgreement.checked) {
                isValid = false;
                errorMessages.push('利用規約に同意してください');
                termsAgreement.parentElement.classList.add('border-red-500');
            } else {
                termsAgreement.parentElement.classList.remove('border-red-500');
            }

            if (!isValid) {
                alert('以下のエラーを修正してください：\n' + errorMessages.join('\n'));
                return;
            }

            // フォームデータを収集
            const formData = new FormData(e.target);
            const applicationData = {
                personalInfo: {
                    last_name: formData.get('last_name'),
                    first_name: formData.get('first_name'),
                    name: formData.get('last_name') + ' ' + formData.get('first_name'),
                    email: formData.get('email'),
                    email_confirm: formData.get('email_confirm'),
                    postal_code: formData.get('postal_code_1') + '-' + formData.get('postal_code_2'),
                    prefecture: formData.get('prefecture'),
                    city: formData.get('city'),
                    address: formData.get('address'),
                    building: formData.get('building'),
                    full_address: formData.get('prefecture') + formData.get('city') + formData.get('address') + (formData.get('building') ? ' ' + formData.get('building') : ''),
                    phone: formData.get('phone_1') + '-' + formData.get('phone_2') + '-' + formData.get('phone_3')
                },
                questions: {},
                receipts: []
            };

            // 質問回答を収集
            questions.forEach(question => {
                const questionName = `question_${question.id}`;
                if (question.type === 'checkbox') {
                    const checkboxes = document.querySelectorAll(`input[name="${questionName}"]:checked`);
                    const values = Array.from(checkboxes).map(cb => cb.value);
                    applicationData.questions[question.question] = values.join(', ');
                } else {
                    const element = document.querySelector(`[name="${questionName}"]`);
                    if (element) {
                        applicationData.questions[question.question] = element.value;
                    }
                }
            });

            // レシート情報を収集
            for (let i = 0; i < receiptCount; i++) {
                const fileInput = document.getElementById(`receipt-file-${i}`);
                if (fileInput && fileInput.files[0]) {
                    applicationData.receipts.push({
                        name: fileInput.files[0].name,
                        size: fileInput.files[0].size,
                        data: fileInput.dataset.imageData
                    });
                }
            }

            // データをローカルストレージに保存
            localStorage.setItem('applicationData', JSON.stringify(applicationData));
            
            // 成功メッセージを表示
            showSuccessMessage('フォームが正常に送信されました');
            
            // 確認画面へ遷移
            setTimeout(() => {
                window.location.href = 'confirm.html';
            }, 1000);
        });

        // メールアドレス確認のリアルタイムバリデーション
        document.addEventListener('DOMContentLoaded', function() {
            const emailField = document.querySelector('input[name="email"]');
            const emailConfirmField = document.querySelector('input[name="email_confirm"]');
            
            if (emailConfirmField) {
                emailConfirmField.addEventListener('input', function() {
                    if (emailField && emailField.value && this.value) {
                        if (emailField.value !== this.value) {
                            this.classList.add('border-red-500');
                        } else {
                            this.classList.remove('border-red-500');
                        }
                    }
                });
            }
        });

        // ドラッグ&ドロップ機能
        document.addEventListener('dragover', function(e) {
            e.preventDefault();
        });

        document.addEventListener('drop', function(e) {
            e.preventDefault();
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                // ファイルを適切なアップロードエリアに配置する処理
                console.log('Dropped files:', files);
            }
        });

        // サンプル質問データ
        const questions = [
            {
                id: 1,
                type: 'textarea',
                question: 'ご意見・ご感想',
                required: false,
                placeholder: 'キャンペーンについてのご意見やご感想をお聞かせください'
            },
            {
                id: 2,
                type: 'radio',
                question: 'このキャンペーンをどこでお知りになりましたか？',
                required: false,
                options: ['テレビCM', 'インターネット広告', 'SNS', '友人・知人', 'その他']
            },
            {
                id: 3,
                type: 'checkbox',
                question: '今後もこのようなキャンペーンに参加したいですか？',
                required: false,
                options: ['はい', 'いいえ', 'どちらともいえない']
            }
        ];

        let receiptCount = 0;
        const maxReceipts = 20;

        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            renderQuestions();
            addReceiptUpload(); // 最初のレシートアップロードエリアを追加
            restoreFormData(); // 前回の入力内容を復元
            
            var year = localStorage.getItem('projectYear') || new Date().getFullYear();
            var footer = document.querySelector('footer .text-gray-400');
            if (footer) {
                footer.textContent = `© ${year} [キャンペーン名] All rights reserved.`;
            }
        });

        // 質問フィールドを表示
        function renderQuestions() {
            const questionFields = document.getElementById('question-fields');
            questionFields.innerHTML = '';

            questions.forEach(question => {
                const fieldDiv = document.createElement('div');
                
                let inputHtml = '';
                switch (question.type) {
                    case 'textarea':
                        inputHtml = `
                            <textarea name="question_${question.id}" 
                                      ${question.required ? 'required' : ''}
                                      placeholder="${question.placeholder}"
                                      rows="4"
                                      class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm"></textarea>
                        `;
                        break;
                    case 'radio':
                        inputHtml = `
                            <div class="space-y-2">
                                ${question.options.map(option => `
                                    <label class="flex items-center">
                                        <input type="radio" name="question_${question.id}" value="${option}" class="form-radio h-4 w-4 text-primary">
                                        <span class="ml-2">${option}</span>
                                    </label>
                                `).join('')}
                            </div>
                        `;
                        break;
                    case 'checkbox':
                        inputHtml = `
                            <div class="space-y-2">
                                ${question.options.map(option => `
                                    <label class="flex items-center">
                                        <input type="checkbox" name="question_${question.id}" value="${option}" class="form-checkbox h-4 w-4 text-primary">
                                        <span class="ml-2">${option}</span>
                                    </label>
                                `).join('')}
                            </div>
                        `;
                        break;
                    default:
                        inputHtml = `
                            <input type="${question.type}" 
                                   name="question_${question.id}" 
                                   ${question.required ? 'required' : ''}
                                   placeholder="${question.placeholder}"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm">
                        `;
                }

                fieldDiv.innerHTML = `
                    <div>
                        <label class="block text-sm font-medium text-gray-700">
                            ${question.question}
                            ${question.required ? '<span class="text-red-500">*</span>' : ''}
                        </label>
                        ${inputHtml}
                    </div>
                `;
                
                questionFields.appendChild(fieldDiv);
            });
        }

        // レシートアップロードエリアを追加
        function addReceiptUpload() {
            if (receiptCount >= maxReceipts) {
                alert('最大20枚までアップロード可能です。');
                return;
            }

            const uploadArea = document.getElementById('receipt-upload-area');
            const receiptDiv = document.createElement('div');
            receiptDiv.className = 'border-2 border-dashed border-gray-300 rounded-lg p-6';
            receiptDiv.id = `receipt-${receiptCount}`;
            
            receiptDiv.innerHTML = `
                <div class="flex items-center justify-center">
                    <div class="text-center">
                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <div class="mt-4 flex text-sm text-gray-600">
                            <label for="receipt-file-${receiptCount}" class="relative cursor-pointer bg-white rounded-md font-medium text-primary hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-primary">
                                <span>レシートをアップロード</span>
                                <input id="receipt-file-${receiptCount}" name="receipt_${receiptCount}" type="file" class="sr-only" accept="image/*" onchange="previewReceipt(${receiptCount}, this)">
                            </label>
                            <p class="pl-1">またはドラッグ&ドロップ</p>
                        </div>
                        <p class="text-xs text-gray-500">PNG, JPG, GIF 最大 5MB</p>
                    </div>
                </div>
                <div id="receipt-preview-${receiptCount}" class="mt-4 hidden">
                    <img id="receipt-image-${receiptCount}" class="max-w-xs mx-auto rounded-lg shadow-sm">
                    <div class="mt-2 text-center">
                        <button type="button" onclick="removeReceipt(${receiptCount})" class="text-sm text-red-600 hover:text-red-800">
                            削除
                        </button>
                    </div>
                </div>
            `;
            
            uploadArea.appendChild(receiptDiv);
            receiptCount++;
        }

        // レシートプレビュー
        function previewReceipt(index, input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById(`receipt-preview-${index}`);
                    const image = document.getElementById(`receipt-image-${index}`);
                    image.src = e.target.result;
                    preview.classList.remove('hidden');
                    
                    // ファイルデータを保存（確認画面で使用）
                    input.dataset.imageData = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // レシート削除
        function removeReceipt(index) {
            const receiptDiv = document.getElementById(`receipt-${index}`);
            const fileInput = document.getElementById(`receipt-file-${index}`);
            fileInput.value = '';
            receiptDiv.remove();
            receiptCount--;
        }
    </script>
</body>
</html> 