<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>応募フォーム - 夏のレシートキャンペーン</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#F59E0B'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <!-- ヘッダー -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="top.html" class="text-xl font-semibold text-gray-900">夏のレシートキャンペーン</a>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">ステップ 1/3</span>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <!-- プログレスバー -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center">
                        <span class="text-white text-sm font-medium">1</span>
                    </div>
                    <span class="ml-2 text-sm font-medium text-gray-900">応募フォーム</span>
                </div>
                <div class="flex-1 mx-4">
                    <div class="h-1 bg-gray-200 rounded-full">
                        <div class="h-1 bg-primary rounded-full" style="width: 33%"></div>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">
                        <span class="text-gray-500 text-sm font-medium">2</span>
                    </div>
                    <span class="ml-2 text-sm text-gray-500">確認</span>
                </div>
                <div class="flex-1 mx-4">
                    <div class="h-1 bg-gray-200 rounded-full"></div>
                </div>
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">
                        <span class="text-gray-500 text-sm font-medium">3</span>
                    </div>
                    <span class="ml-2 text-sm text-gray-500">完了</span>
                </div>
            </div>
        </div>

        <!-- フォーム -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">応募フォーム</h2>
                
                <form id="application-form" class="space-y-8">
                    <!-- アンケートセクション -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">アンケート</h3>
                        <div id="question-fields" class="space-y-6">
                            <!-- 質問フィールドはJavaScriptで動的に生成 -->
                        </div>
                    </div>

                    <!-- レシートアップロードセクション -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">レシートアップロード</h3>
                        <div class="space-y-4">
                            <p class="text-sm text-gray-600">
                                対象商品のレシートを撮影してアップロードしてください。最大20枚までアップロード可能です。
                            </p>
                            
                            <div id="receipt-upload-area" class="space-y-4">
                                <!-- レシートアップロードエリアはJavaScriptで動的に生成 -->
                            </div>
                            
                            <button type="button" onclick="addReceiptUpload()" 
                                    class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                レシートを追加
                            </button>
                        </div>
                    </div>

                    <!-- 送信ボタン -->
                    <div class="flex justify-between pt-6 border-t border-gray-200">
                        <a href="top.html" 
                           class="inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                            戻る
                        </a>
                        <button type="submit" 
                                class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            確認画面へ
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- フッター -->
    <footer class="bg-gray-800 mt-12">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <p class="text-sm text-gray-400">
                    © 2024 レシートキャンペーン. All rights reserved.
                </p>
            </div>
        </div>
    </footer>

    <script>
        // サンプル質問データ
        const questions = [
            {
                id: 1,
                type: 'text',
                question: 'お名前',
                required: true,
                placeholder: '例: 田中太郎'
            },
            {
                id: 2,
                type: 'email',
                question: 'メールアドレス',
                required: true,
                placeholder: '例: tanaka@example.com'
            },
            {
                id: 3,
                type: 'tel',
                question: '電話番号',
                required: false,
                placeholder: '例: 090-1234-5678'
            },
            {
                id: 4,
                type: 'textarea',
                question: 'ご意見・ご感想',
                required: false,
                placeholder: 'キャンペーンについてのご意見やご感想をお聞かせください'
            }
        ];

        let receiptCount = 0;
        const maxReceipts = 20;

        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            renderQuestions();
            addReceiptUpload(); // 最初のレシートアップロードエリアを追加
        });

        // 質問フィールドを表示
        function renderQuestions() {
            const questionFields = document.getElementById('question-fields');
            questionFields.innerHTML = '';

            questions.forEach(question => {
                const fieldDiv = document.createElement('div');
                
                let inputHtml = '';
                switch (question.type) {
                    case 'textarea':
                        inputHtml = `
                            <textarea name="question_${question.id}" 
                                      ${question.required ? 'required' : ''}
                                      placeholder="${question.placeholder}"
                                      rows="4"
                                      class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm"></textarea>
                        `;
                        break;
                    default:
                        inputHtml = `
                            <input type="${question.type}" 
                                   name="question_${question.id}" 
                                   ${question.required ? 'required' : ''}
                                   placeholder="${question.placeholder}"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm">
                        `;
                }

                fieldDiv.innerHTML = `
                    <div>
                        <label class="block text-sm font-medium text-gray-700">
                            ${question.question}
                            ${question.required ? '<span class="text-red-500">*</span>' : ''}
                        </label>
                        ${inputHtml}
                    </div>
                `;
                
                questionFields.appendChild(fieldDiv);
            });
        }

        // レシートアップロードエリアを追加
        function addReceiptUpload() {
            if (receiptCount >= maxReceipts) {
                alert('最大20枚までアップロード可能です。');
                return;
            }

            const uploadArea = document.getElementById('receipt-upload-area');
            const receiptDiv = document.createElement('div');
            receiptDiv.className = 'border-2 border-dashed border-gray-300 rounded-lg p-6';
            receiptDiv.id = `receipt-${receiptCount}`;
            
            receiptDiv.innerHTML = `
                <div class="flex items-center justify-center">
                    <div class="text-center">
                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <div class="mt-4 flex text-sm text-gray-600">
                            <label for="receipt-file-${receiptCount}" class="relative cursor-pointer bg-white rounded-md font-medium text-primary hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-primary">
                                <span>レシートをアップロード</span>
                                <input id="receipt-file-${receiptCount}" name="receipt_${receiptCount}" type="file" class="sr-only" accept="image/*" onchange="previewReceipt(${receiptCount}, this)">
                            </label>
                            <p class="pl-1">またはドラッグ&ドロップ</p>
                        </div>
                        <p class="text-xs text-gray-500">PNG, JPG, GIF 最大 5MB</p>
                    </div>
                </div>
                <div id="receipt-preview-${receiptCount}" class="mt-4 hidden">
                    <img id="receipt-image-${receiptCount}" class="max-w-xs mx-auto rounded-lg shadow-sm">
                    <div class="mt-2 text-center">
                        <button type="button" onclick="removeReceipt(${receiptCount})" class="text-sm text-red-600 hover:text-red-800">
                            削除
                        </button>
                    </div>
                </div>
            `;
            
            uploadArea.appendChild(receiptDiv);
            receiptCount++;
        }

        // レシートプレビュー
        function previewReceipt(index, input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById(`receipt-preview-${index}`);
                    const image = document.getElementById(`receipt-image-${index}`);
                    image.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // レシート削除
        function removeReceipt(index) {
            const receiptDiv = document.getElementById(`receipt-${index}`);
            const fileInput = document.getElementById(`receipt-file-${index}`);
            fileInput.value = '';
            receiptDiv.remove();
            receiptCount--;
        }

        // フォーム送信処理
        document.getElementById('application-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // バリデーション
            const requiredFields = document.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.classList.add('border-red-500');
                } else {
                    field.classList.remove('border-red-500');
                }
            });

            if (!isValid) {
                alert('必須項目を入力してください。');
                return;
            }

            // フォームデータを収集
            const formData = new FormData(this);
            const applicationData = {
                questions: {},
                receipts: []
            };

            // 質問データを収集
            questions.forEach(question => {
                const field = document.querySelector(`[name="question_${question.id}"]`);
                if (field) {
                    applicationData.questions[question.question] = field.value;
                }
            });

            // レシートデータを収集
            for (let i = 0; i < receiptCount; i++) {
                const fileInput = document.getElementById(`receipt-file-${i}`);
                if (fileInput && fileInput.files[0]) {
                    applicationData.receipts.push({
                        name: fileInput.files[0].name,
                        size: fileInput.files[0].size
                    });
                }
            }

            // ローカルストレージに保存（実際の実装ではサーバーに送信）
            localStorage.setItem('applicationData', JSON.stringify(applicationData));
            
            // 確認画面へ遷移
            window.location.href = 'confirm.html';
        });

        // ドラッグ&ドロップ機能
        document.addEventListener('dragover', function(e) {
            e.preventDefault();
        });

        document.addEventListener('drop', function(e) {
            e.preventDefault();
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                // ファイルを適切なアップロードエリアに配置する処理
                console.log('Dropped files:', files);
            }
        });
    </script>
</body>
</html> 